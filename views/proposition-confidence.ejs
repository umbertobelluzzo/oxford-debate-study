<!-- views/proposition-confidence.ejs -->
<!DOCTYPE html>
<html>

<head>
    <title>Political Opinion Study - Confidence</title>
    <link rel="stylesheet" href="/styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
    <div class="container">
        <div class="study-card">
            <div class="sticky-header">
                <div class="counter-badges">
                    <div class="counter-badge-container">
                        <span class="counter-badge-label">Statement:</span>
                        <div class="counter-badge">
                            <%= index %> of <%= total %>
                        </div>
                    </div>
                    <div class="counter-badge-container">
                        <span class="counter-badge-label">Step:</span>
                        <div class="counter-badge step-badge">1 of 2</div>
                    </div>
                    <div class="counter-badge-container">
                        <span class="counter-badge-label">Screen:</span>
                        <div class="counter-badge screen-badge">7 of 7</div>
                    </div>
                </div>

                <form action="/proposition-confidence" method="POST" id="confidenceForm">
                    <p>Consider this statement:</p>
                    <div class="content-container content-container-proposition">
                        <div class="content-text content-text-proposition">
                            <%= proposition %>
                        </div>
                    </div>

                    <p>Here is the paragraph you wrote:</p>
                    <div class="content-container content-container-writer">
                        <div class="content-text content-text-writer">
                            <%= writerParagraph %>
                        </div>
                    </div>
            </div>

            <div class="scrollable-content">
                <div class="form-group">
                    <label for="confidence">How <b>confident</b> are you in <span style="color: #27ae60;"><b>your opinion</b></span> on this issue?</label>
                    <div class="stance-scale">
                        <span>0 = Not confident at all </span>
                        <span>50 = Moderately confident </span>
                        <span>100 = Extremely confident</span>
                    </div>
                    <input type="range" id="confidence" name="confidence" min="0" max="100" class="slider slider-unset"
                        required>
                    <div class="stance-value">
                        <span id="confidenceValue" class="hidden">0</span>
                        <span id="confidenceLabel" class="slider-label">Please click on the scale to set your
                            rating</span>
                    </div>
                </div>
                <br>

                <div class="button-container">
                    <button type="submit" class="button">Continue</button>
                </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Update confidence value display
        const confidenceSlider = document.getElementById('confidence');
        const confidenceValue = document.getElementById('confidenceValue');
        const confidenceLabel = document.getElementById('confidenceLabel');
        const confidenceForm = document.getElementById('confidenceForm');

        // Initialize slider state
        let sliderSet = false;

        confidenceSlider.oninput = function () {
            // Update the value display
            confidenceValue.textContent = "Current value: " + this.value;

            // Show the value and hide the prompt
            confidenceValue.classList.remove('hidden');
            confidenceLabel.classList.add('hidden');

            // Mark the slider as set
            this.classList.remove('slider-unset');
            this.classList.add('slider-set');

            // Update state
            sliderSet = true;
        }

        // Form validation before submission
        confidenceForm.addEventListener('submit', function (e) {
            if (!sliderSet) {
                e.preventDefault(); // Prevent form submission
                alert('Please set a value on the rating scale before continuing.');

                confidenceLabel.style.color = 'red';
                confidenceLabel.style.fontWeight = 'bold';
            }
        });
    </script>
    <script src="/button-disable.js"></script>
</body>

</html>