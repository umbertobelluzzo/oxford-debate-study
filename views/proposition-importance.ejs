<!-- views/proposition-importance.ejs -->
<!DOCTYPE html>
<html>

<head>
    <title>Political Opinion Study - Importance Rating</title>
    <link rel="stylesheet" href="/styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
    <div class="container">
        <div class="study-card">
            <div class="sticky-header">
                <div class="counter-badges">
                    <div class="counter-badge-container">
                        <span class="counter-badge-label">Statement:</span>
                        <div class="counter-badge">
                            <%= index %> of <%= total %>
                        </div>
                    </div>
                    <div class="counter-badge-container">
                        <span class="counter-badge-label">Step:</span>
                        <div class="counter-badge step-badge">1 of 2</div>
                    </div>
                    <div class="counter-badge-container">
                        <span class="counter-badge-label">Screen:</span>
                        <div class="counter-badge screen-badge">3 of 9</div>
                    </div>
                </div>

                <form action="/proposition-importance" method="POST" id="importanceForm">
                    <p>Consider this statement:</p>
                    <div class="content-container content-container-proposition">
                        <div class="content-text content-text-proposition">
                            <%= proposition %>
                        </div>
                    </div>
            </div>

            <div class="scrollable-content">
                <div class="form-group">
                    <label for="importance">How <b>important</b> is this issue to you?</label>
                    <div class="stance-scale">
                        <span>0 = Not important at all </span>
                        <span>50 = Moderately important </span>
                        <span>100 = Extremely important</span>
                    </div>
                    <input type="range" id="importance" name="importance" min="0" max="100" class="slider slider-unset"
                        required>
                    <div class="stance-value">
                        <span id="importanceValue" class="hidden">0</span>
                        <span id="importanceLabel" class="slider-label">Please click on the scale to set your
                            rating</span>
                    </div>
                </div>
                <br>

                <div class="button-container">
                    <button type="submit" class="button">Continue</button>
                </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Update importance value display
        const importanceSlider = document.getElementById('importance');
        const importanceValue = document.getElementById('importanceValue');
        const importanceLabel = document.getElementById('importanceLabel');
        const importanceForm = document.getElementById('importanceForm');

        // Initialize slider state
        let sliderSet = false;

        importanceSlider.oninput = function () {
            // Update the value display
            importanceValue.textContent = "Current value: " + this.value;

            // Show the value and hide the prompt
            importanceValue.classList.remove('hidden');
            importanceLabel.classList.add('hidden');

            // Mark the slider as set
            this.classList.remove('slider-unset');
            this.classList.add('slider-set');

            // Update state
            sliderSet = true;
        }

        // Form validation before submission
        importanceForm.addEventListener('submit', function (e) {
            if (!sliderSet) {
                e.preventDefault(); // Prevent form submission
                alert('Please set a value on the rating scale before continuing.');

                importanceLabel.style.color = 'red';
                importanceLabel.style.fontWeight = 'bold';
            }
        });
    </script>
</body>

</html>