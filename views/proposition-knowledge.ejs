<!-- views/proposition-knowledge.ejs -->
<!DOCTYPE html>
<html>

<head>
    <title>Political Opinion Study - Knowledge Rating</title>
    <link rel="stylesheet" href="/styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
    <div class="container">
        <div class="study-card">
            <div class="sticky-header">
                <div class="counter-badges">
                    <div class="counter-badge-container">
                        <span class="counter-badge-label">Statement:</span>
                        <div class="counter-badge">
                            <%= index %> of <%= total %>
                        </div>
                    </div>
                    <div class="counter-badge-container">
                        <span class="counter-badge-label">Step:</span>
                        <div class="counter-badge step-badge">1 of 2</div>
                    </div>
                    <div class="counter-badge-container">
                        <span class="counter-badge-label">Screen:</span>
                        <div class="counter-badge screen-badge">4 of 7</div>
                    </div>
                </div>

                <form action="/proposition-knowledge" method="POST" id="knowledgeForm">
                    <p>Consider this statement:</p>
                    <div class="content-container content-container-proposition">
                        <div class="content-text content-text-proposition">
                            <%= proposition %>
                        </div>
                    </div>
            </div>

            <div class="scrollable-content">
                <div class="form-group">
                    <label for="knowledge">How much do you <b>know</b> about the issue referenced in this statement?</label>
                    <div class="stance-scale">
                        <span>0 = No knowledge at all </span>
                        <span>50 = Some understanding </span>
                        <span>100 = Expert knowledge</span>
                    </div>
                    <input type="range" id="knowledge" name="knowledge" min="0" max="100" class="slider slider-unset"
                        required>
                    <div class="stance-value">
                        <span id="knowledgeValue" class="hidden">0</span>
                        <span id="knowledgeLabel" class="slider-label">Please click on the scale to set your
                            rating</span>
                    </div>
                </div>
                <br>

                <div class="button-container">
                    <button type="submit" class="button">Continue</button>
                </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Update knowledge value display
        const knowledgeSlider = document.getElementById('knowledge');
        const knowledgeValue = document.getElementById('knowledgeValue');
        const knowledgeLabel = document.getElementById('knowledgeLabel');
        const knowledgeForm = document.getElementById('knowledgeForm');

        // Initialize slider state
        let sliderSet = false;

        knowledgeSlider.oninput = function () {
            // Update the value display
            knowledgeValue.textContent = "Current value: " + this.value;

            // Show the value and hide the prompt
            knowledgeValue.classList.remove('hidden');
            knowledgeLabel.classList.add('hidden');

            // Mark the slider as set
            this.classList.remove('slider-unset');
            this.classList.add('slider-set');

            // Update state
            sliderSet = true;
        }

        // Form validation before submission
        knowledgeForm.addEventListener('submit', function (e) {
            if (!sliderSet) {
                e.preventDefault(); // Prevent form submission
                alert('Please set a value on the rating scale before continuing.');

                knowledgeLabel.style.color = 'red';
                knowledgeLabel.style.fontWeight = 'bold';
            }
        });
    </script>
</body>

</html>